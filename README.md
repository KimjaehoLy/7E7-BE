# MarketClip
<h2>https://marketclip.kr/</h2>

### 😎요즘은 짧은 영상이 대세! 쇼핑에도 영상을 보는 즐거움이 있는 마켓클립!
<p align="center"><img src="https://wook-bucket.s3.ap-northeast-2.amazonaws.com/222222.png" />


<br />
<br />
  
# 👥 멤버
- Front-end: [이덕희](https://github.com/ejzl521), [장산](https://github.com/kyngmn)
- Back-end: [임선용](https://github.com/sunyongIM), [김재호](https://github.com/KimjaehoLy), [남신욱](https://github.com/tlsdnr1135)
- Designer: 이수진, 안수현
- [\[Front-End Github\]](https://github.com/TEAM-7E7/7E7-FE)
- [\[Marketclip Notion\]](https://www.notion.so/Market-Clip-b0feee01a3454f85962915faa7047410)
https://www.notion.so/BackEnd-3646a509dede404184b9128ec99c66b8
- [\[Marketclip Notion(BE)\]](https://www.notion.so/Market-Clip-b0feee01a3454f85962915faa7047410)
  
  
<br />

# 🗓 프로젝트 기간
- 2022년 6월 24일 ~ 2022년 8월 05일
  

<br><br>
# 🎞 프로젝트 발표영상 🎞
https://www.youtube.com/watch?v=sQ2qn1elfGQ

<br><br>
# 🎞 프로젝트 시연영상 🎞
https://www.youtube.com/watch?v=GsA8UhmQMKo&t=1s

<br>

# 🗺 ER Diagram
<center><img src="https://user-images.githubusercontent.com/91590293/182981843-124a76a6-b7e7-4718-83a2-2ec0c72532e4.png" width:"1200"></center>
  
<br /><br />
# 📌 API 명세서
<center><img src="https://wook-bucket.s3.ap-northeast-2.amazonaws.com/API+%EC%9A%94%EC%95%BD+%EC%82%AC%EC%A7%841.png" width:"1200"></center>

<br /><br />
  
# ⚙️ 기술 스택
  
### Front-End

<div>
<img src="http://img.shields.io/badge/-JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white" />
<img src="https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB" />
<img src="http://img.shields.io/badge/-HTML5-E34F26?style=for-the-badge&logo=HTML5&logoColor=white" />
<img src="http://img.shields.io/badge/-CSS3-1572B6?style=for-the-badge&logo=CSS3&logoColor=white" />
<img src="https://img.shields.io/badge/Typescript-3178C6?style=for-the-badge&logo=Typescript&logoColor=white">
<img src="http://img.shields.io/badge/-Python-3776AB?style=for-the-badge&logo=Python&logoColor=white" />
</div>
<div>
<img src="https://img.shields.io/badge/Redux-764ABC?style=for-the-badge&logo=Redux&logoColor=white">
<img src="https://img.shields.io/badge/Recoil-673AB8?style=for-the-badge&logo=Recoil&logoColor=white">
<img src="https://img.shields.io/badge/React Query-FF4154?style=for-the-badge&logo=React Query&logoColor=white">
</div>
<div>
<img src="https://img.shields.io/badge/NGINX-009639?style=for-the-badge&logo=NGINX&logoColor=white">
<img src="http://img.shields.io/badge/-Amazon AWS-232F3E?style=for-the-badge&logo=Amazon AWS&logoColor=white" />
<img src="http://img.shields.io/badge/-Amazon S3-569A31?style=for-the-badge&logo=Amazon S3&logoColor=white" />
<img src="http://img.shields.io/badge/-Amazon EC2-FF4F8B?style=for-the-badge&logo=Amazon EC2&logoColor=white" />
<img src="http://img.shields.io/badge/-GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white" />
  <img src="http://img.shields.io/badge/-Cloud Front-512BD4?style=for-the-badge&logo=&logoColor=white" />
</div>  

### Back-End

<div>
  <img alt="Java" src ="https://img.shields.io/badge/Java-007396.svg?&style=for-the-badge&logo=Java&logoColor=white"/>
  <img alt="Spring Boot" src ="https://img.shields.io/badge/Spring Boot-6DB33F.svg?&style=for-the-badge&logo=Spring Boot&logoColor=white"/>
  <img alt="SonarLint" src ="https://img.shields.io/badge/SonarLint-CB2029.svg?&style=for-the-badge&logo=SonarLint&logoColor=white"/>
  <img alt="Gradle" src ="https://img.shields.io/badge/Gradle-02303A.svg?&style=for-the-badge&logo=Gradle&logoColor=white"/>
  <img alt="Spring Security" src ="https://img.shields.io/badge/Spring Security-6DB33F.svg?&style=for-the-badge&logo=Spring Security&logoColor=white"/>
</div>
<div>
  <img alt="Amazon RDS" src="https://img.shields.io/badge/Amazon RDS-527FFF?style=for-the-badge&logo=Amazon RDS&logoColor=white"/>
  <img alt="MySQL" src ="https://img.shields.io/badge/MySQL-4479A1.svg?&style=for-the-badge&logo=MySQL&logoColor=white"/>
  <img alt="Hibernate" src ="https://img.shields.io/badge/Hibernate-59666C.svg?&style=for-the-badge&logo=Hibernate&logoColor=white"/>
  <img alt="Amazon S3" src="https://img.shields.io/badge/Amazon S3-569A31?style=for-the-badge&logo=Amazon S3&logoColor=white"/>
  <img alt="Redis" src="https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=Redis&logoColor=white"/>
</div>
<div>
  <img alt="GitHub Actions" src="https://img.shields.io/badge/GitHub Actions-2088FF?style=for-the-badge&logo=GitHub Actions&logoColor=white"/>
  <img alt="Amazon AWS" src="https://img.shields.io/badge/Amazon AWS-232F3E?style=for-the-badge&logo=Amazon AWS&logoColor=white"/>
  <img alt="Amazon EC2" src="https://img.shields.io/badge/Amazon EC2-FF4F8B?style=for-the-badge&logo=Amazon EC2&logoColor=white"/>
  <img alt="NGINX" src="https://img.shields.io/badge/NGINX-009639?style=for-the-badge&logo=NGINX&logoColor=white">
  <img alt="Swagger" src="https://img.shields.io/badge/Swagger-59666C?style=for-the-badge&logo=Swagger&logoColor=white"/>
</div>

<br />  




# 🖼 아키텍쳐
<center><img src="https://wook-bucket.s3.ap-northeast-2.amazonaws.com/%EB%A7%88%EC%BC%93%ED%81%B4%EB%A6%BD+%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90.PNG" width:"1200"></center>

<br />

# 🔑 프로젝트 백엔드 주요 기능
  
* 로그인, 소셜 로그인 
  - 로그인 시 JWT 토큰, Refresh 토큰 발행
  - google, kakao 소셜 로그인 가능.
  - Access 토큰 만료시 Refresh토큰으로 Access토큰 재발행
  
* 채팅
  - 구매자는 원하는 게시글에 채팅을 보낼 수 있음.
  - 채팅방 삭제 시 상대방에게 상대방이 나갔다는 알람 보여줌.
  - 채팅 기능에 redis 의 pub/sub 자체 기능을 적용 시킴.

* 게시글
  - 원하는 카테고리를 다수 선택하여 게시글 조회 가능
  - querydsl 동적쿼리를 사용하여 게시글을 불러옴
  - 메인화면, 마이페이지의 판매목록/구매목록/저장목록 페이징처리

* 거래하기
  - 판매자가 구매자들중 한명에게 거래 신청을 함.
  - 거래 신청을 하면 구매자의 채팅에 수락or거절 버튼이 생김
  - 판매자가 수락or거절 누르기 전에는 게시글이 '예약중' 상태가 됨.
  - 수락) 수락 시 게시글이 '판매완료'로 바뀜
  - 거절) 거절 시 게시글이 '판매중' 상태로 바뀜

* redis 캐시 
  - 수정과 삭제가 잦지 않은 데이터에 캐시 기능을 적용해 서버 응답속도 개선
  - 게시글 상세페이지, 내가 쓴 글 보기, 내가 구매한 글 보기 적용
  - 채팅방에도 적용 했었으나, 채팅이 생길 때 마다 최신순으로 채팅방을 정렬해 주는 기능이 있어서 삭제함
  
<br />




# 💡 Trouble Shooting
<details>
  <summary>
    <b> CI/CD 작업 이후 프로젝트 명 변경으로 인한 서버 에러 발생 </b>
  </summary>
  
```bash
REPOSITORY=/home/ubuntu/
cd $REPOSITORY

APP_NAME=marketclip
JAR_NAME=$(ls $REPOSITORY/build/libs/ | grep 'SNAPSHOT.jar' | tail -n 1)
JAR_PATH=$REPOSITORY/build/libs/$JAR_NAME

CURRENT_PID=$(pgrep -f $APP_NAME)

echo ">현재 구동 중인 애플리케이션 pid: $CURRENT_PID"

if [ -z $CURRENT_PID ]
then
  echo ">현재 구동 중인 애플리케이션이 없으므로 종료하지 않습니다."
else
  echo "> kill -9 $CURRENT_PID"
  sudo kill -15 $CURRENT_PID
  sleep 5
fi
```
* ###### 프로젝트 프로젝트 명 변경으로 인해 kill 명령어가 실행되지 않아서 일어나는 오류
##### 해결
* ###### 단순히 EC2의 (전 프로젝트명의)프로젝트를 강제적으로 kill하고 재실행 해줬다
</details>

<details>
  <summary>
    <b> 스프링 시큐리티 예외처리 </b>
  </summary>
  
* ###### 스프링 시큐리티는 서블릿 필터에서 발생하는 오류라 ControllerAdvice에서 잡지 못한다.
* ###### 그래서 필터 계층에서 예외 처리를 해주어야 했다.
  
##### 해결
* ###### 시큐리티에 등록한 필터들 마다 예외 처리를 해주었다
</details>

<details>
  <summary>
    <b> 게시글 작성 시 이미지 순서 문제 </b>
  </summary>
  
* ###### 게시글을 작성 시 여러개의 사진을 올릴 수 있는데 순서가 중요함.
* ###### 수정을 할 때 새로운 이미지와 기존에 있던 이미지를 순서대로 받기가 힘듬.(다른 타입의 변수를 하나의 객체로)
  
###### 해결![베짱이](https://user-images.githubusercontent.com/68206513/182992929-09e4a00b-8e45-4cba-b279-822c08784c8d.png)

* ###### 이미지를 Url로 변환시켜주는 (S3에 저장하는) api를 따로 만들었다.
* ###### FE에서 이미지를 업로드 하는 동시에 위의 api를 호출하면 MultipartFile이 아닌 String 타입의 url이 return 되고,
* ###### 해당 url을 가지고 게시글 수정 api를 호출하는 로직으로 변경하였다
* ###### 하지만, 이 해결법에는 S3 서버의 데이터 누수가 있을 수 있기 때문에 scheduler의 관리가 필요하다
  
</details>


<details>
  <summary>
    <b> 서버 재시작 시 ChannelTopic이  사라짐</b>
  </summary>
  
* ###### 서버가 재시작 되면 메모리 저장소에 남아있는 ChannelTopic이 사라지게 되어 채팅이 비활성화 됨.
  
###### 해결 
* ###### 서버 시작시 DB에 담겨있는 채팅방 아이디를 불러와서 ChannelTopic 에 담아줌
</details>

<br />

# Team Marketclip - Backend

<br>

마켓클립 백엔드 개발진들🧡


| [임선용🔰](https://github.com/sunyongIM) | [김재호](https://github.com/KimjaehoLy) | [남신욱](https://github.com/tlsdnr1135) |                                                                                                            
| :---------------------------------: | :----------------------------------: | :-----------------------------: |
| <img src="https://user-images.githubusercontent.com/91590293/182991861-78a60df8-2de4-4a64-b20e-fb6c930e4d68.jpg" alt="임선용" width="200px"/> |  <img src="https://user-images.githubusercontent.com/68206513/182992939-620a49cc-e9d3-4d96-867a-e97477fda85a.png" alt="김재호" width="200px"/> | <img src="" alt="남신욱" width="200px" /> |
| `백엔드 CI/CD` `이메일 인증` `회원정보 CRUD` <br> `게시글 CRUD` `즐겨찾기` `마이페이지` <br> `queryDsl 동적쿼리` `Redis - 캐싱, 분산락` <br> `Scheduler - Mysql, S3 스토리지 관리` | `WebSocket` `Redis Pub/Sub` <br> `채팅방 생성` <br> `실시간 채팅` <br> `거래 기능` | `Spring Security` `JWT` <br> `OAuth2.0` `소셜 로그인`|


